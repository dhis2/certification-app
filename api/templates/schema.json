{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://dhis2.org/schemas/certification-template.json",
  "title": "DHIS2 Certification Template",
  "description": "Schema for DHIS2 server certification assessment templates",
  "type": "object",
  "required": ["name", "version", "categories"],
  "additionalProperties": false,
  "properties": {
    "name": {
      "type": "string",
      "minLength": 1,
      "maxLength": 255,
      "description": "Template name"
    },
    "version": {
      "type": "integer",
      "minimum": 1,
      "description": "Template version number"
    },
    "description": {
      "type": "string",
      "maxLength": 4000,
      "description": "Template description"
    },
    "effectiveFrom": {
      "type": "string",
      "format": "date",
      "description": "Date when template becomes effective (ISO 8601)"
    },
    "effectiveTo": {
      "type": "string",
      "format": "date",
      "description": "Date when template expires (ISO 8601)"
    },
    "categories": {
      "type": "array",
      "minItems": 1,
      "maxItems": 50,
      "items": { "$ref": "#/definitions/category" },
      "description": "Assessment categories"
    }
  },
  "definitions": {
    "category": {
      "type": "object",
      "required": ["name", "weight", "sortOrder", "criteria"],
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 255
        },
        "description": {
          "type": "string",
          "maxLength": 2000
        },
        "weight": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Category weight (0-1, all weights must sum to 1)"
        },
        "sortOrder": {
          "type": "integer",
          "minimum": 0
        },
        "criteria": {
          "type": "array",
          "minItems": 1,
          "maxItems": 100,
          "items": { "$ref": "#/definitions/criterion" }
        }
      }
    },
    "criterion": {
      "type": "object",
      "required": ["code", "name", "controlType"],
      "additionalProperties": false,
      "properties": {
        "code": {
          "type": "string",
          "minLength": 1,
          "maxLength": 50,
          "pattern": "^[A-Z]{2,4}-[0-9]{1,3}$",
          "description": "Control code (e.g., DB-01, OS-02)"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 255
        },
        "description": {
          "type": "string",
          "maxLength": 2000
        },
        "verificationMethod": {
          "type": "string",
          "maxLength": 4000,
          "description": "How to verify compliance"
        },
        "guidance": {
          "type": "string",
          "maxLength": 4000,
          "description": "Implementation guidance"
        },
        "controlType": {
          "type": "string",
          "enum": ["technical", "organizational"]
        },
        "controlGroup": {
          "type": "string",
          "enum": ["DSCP1"],
          "default": "DSCP1"
        },
        "isMandatory": {
          "type": "boolean",
          "default": false
        },
        "isCriticalFail": {
          "type": "boolean",
          "default": false
        },
        "evidenceRequired": {
          "type": "boolean",
          "default": false
        },
        "evidenceDescription": {
          "type": "string",
          "maxLength": 1000
        },
        "cisMapping": {
          "type": ["string", "null"],
          "maxLength": 50,
          "description": "CIS Controls reference"
        },
        "weight": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 1
        },
        "minPassingScore": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "default": 0
        },
        "maxScore": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 100
        }
      }
    }
  }
}
